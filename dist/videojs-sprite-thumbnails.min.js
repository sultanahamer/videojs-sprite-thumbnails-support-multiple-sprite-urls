/*! @name videojs-sprite-thumbnails @version 2.1.1 @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).videojsSpriteThumbnails=e(t.videojs)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=e(t);const n=(t,e,n)=>{let i,r,s,a,l,d,u,c,h;const f=window.navigator,p=f.connection||f.mozConnection||f.webkitConnection,g=o.default.dom,m=o.default.obj.merge,b={},y=m({},e.state),v=t.controlBar,x=v&&v.progressControl,w=x&&x.seekBar,k=w&&w.mouseTimeDisplay&&w.mouseTimeDisplay.timeTooltip,$=k&&k.el(),j=$&&$.style,P=()=>u&&u.length>0,S=()=>{const t=b[u[0]],e=t.naturalWidth,o=t.naturalHeight;t&&t.complete&&(c=Math.round(e/s*(o/r)),h=c*n.interval)},M=e=>{if(0===Object.keys(b).length)return;const o=w.el();let a=Math.floor(g.getPointerPosition(o,e).x*t.duration());const l=(t=>{if(!P())return i;const e=Math.ceil((t+1)/n.interval);isNaN(c)&&S();const o=Math.ceil(e/c);return u[o-1]})(a),d=b[l];if(!d)return;const f=d.naturalWidth,p=d.naturalHeight;if(d.complete&&f&&p){P()&&(a%=h),a/=n.interval;const e=n.responsive,i=t.currentWidth(),d=e&&i<e?i/e:1,u=f/s,c=s*d,m=r*d,b=Math.floor(a%u)*-c,y=Math.floor(a/u)*-m,x=`${f*d}px ${p*d}px`,w=g.findPosition(v.el()).top,k=g.findPosition(o).top,j={backgroundImage:`url("${l}")`,backgroundRepeat:"no-repeat",backgroundPosition:`${b}px ${y}px`,backgroundSize:x,top:`${-m-Math.max(0,k-w)}px`,color:"#fff",textShadow:"1px 1px #000",border:"1px solid #000",width:`${c+2}px`,height:`${m+2}px`};Object.keys(j).forEach((t=>{$.style[t]=j[t]}))}},T=()=>{const o=e.name,c=t.currentSources().find((t=>t.hasOwnProperty(o))),h=c&&c[o];h&&(e.setState(y),(n=m(n,h)).url=h.url),i=n.url,r=n.height,s=n.width,a=n.downlink,d=!p||p.downlink>=a,l=!!b[i],u=n.urls,e.setState({ready:!!(k&&s&&r&&i&&(l||d)),diagnostics:!0})},E=t=>{let o=`loading ${t}`;b[t]?o=`re${o}`:b[t]=g.createEl("img",{src:t}),e.log.debug(o)};e.on("statechanged",(()=>{const t=e.state,o=["mousemove","touchmove"],r=e.log,s=r.debug;t.ready?(P()?(u.forEach(E),S()):E(i),s("ready to show thumbnails"),x.on(o,M)):(x.off(o,M),$&&j&&($.style=j),t.diagnostics&&(s("resetting"),["url","width","height"].forEach((t=>{n[t]||r(`no thumbnails ${t} given`)})),p&&!d&&r.warn(`connection.downlink < ${a}`)))})),t.on("loadstart",T),T(),t.addClass("vjs-sprite-thumbnails")};const i=o.default.getPlugin("plugin"),r={url:"",width:0,height:0,interval:1,responsive:600,downlink:1.5,urls:[]};class s extends i{constructor(t,e){super(t,e),this.options=o.default.obj.merge(r,e),this.player.ready((()=>{n(this.player,this,this.options)}))}}return s.defaultState={ready:!1,diagnostics:!1},s.VERSION="2.1.1",o.default.registerPlugin("spriteThumbnails",s),s}));
